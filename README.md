# MOT for Embedded Devices

## Overview

A lightweight Multi-object Tracking (MOT) system tailored for low-cost embedded platforms aiming to minimize the computational demand needed. It combines frame difference-based object detection with the Kernelized Correlation Filter (KCF) tracker enhanced by Average Peak-to-Correlation Energy (APCE) which evaluates tracking quality. A high confidence model update strategy is employed to avoid contaminating the KCF model. 

The system pair detection results to trackers using an approximate Hungarian algorithm, leveraging both IoU and HOG features to enhance matching accuracy and reduce ID switches. Our system also reuses response maps and HOG features generated by KCF during tracking, improving performance without incurring extra computation. 


## Features

- **Detection**
  - A hybrid frame differencing method combining two-frame and background differencing, enhanced with a dynamic background modeling strategy, improving robustness in static scenes under fixed cameras.
  - Reuse of HOG features generated during KCF tracking, boosting system performance with negligible additional overhead.
- **Tracking**
  - Use APCE and peak value for evaluating tracking quality
  - Use high confidence model update strategy to avoid contaminating the KCF model when occlusion happened. 
- **Data Association**
  - Reuse of HOG and LAB features generated during KCF tracking, boosting system performance with negligible additional overhead.
  - Using Intersection over Union (IoU) for data assocition.


##  Project Structure

```
.
├── bin                   # Binary outputs
├── build                 # Intermediate file for CMake
├── kcf/                  # Modified KCF implementation
├── ObjectDetect/         # Object Detection using frame differencing
├── ObjectTrack/          # Object Tracking using KCF, and Data Association using IoU, HOG and LAB
├── src/                  # Additional functions and main function
├── PETS09-S2L1/          # Test set, image sequence and ground truth
├── LICENSE               # License
├── README.md             # This file, including overall information

```


## Input Format

Supports:
- Video file input.
- Image sequence input with formatted path, e.g. `../dataset/frames/%06d.jpg`

The default path pattern is:

```cpp

string path = "../" + NAME + "/" + imDir + "/%06d" + imExt;

```

Modify in `main.cpp` as needed.


## Build Instructions

### Prerequisites

- C++17 or newer
- CMake ≥ 3.16
- OpenCV


### Build

```bash
cd ./build
cmake ..
make
```


## Usage

Run the Test Program: 

```bash
cd ./build
cmake -DCMAKE_BUILD_TYPE=Release ..
make
../bin/main
```

Run with self-define input:

```bash
cd ./build
cmake -DCMAKE_BUILD_TYPE=Release ..
make
../bin/main <input>
```

- input: camera index, video or path to image sequence. 
           E.g., 0, "../PETS09-S2L1/img1%06d.jpg".



## Visualization

- **Blue bounding box**: Detection result
- **Red bounding box**: KCF-tracked object
- APCE value and Peak values are displayed below the tracked box


## Configuration

Most parameters can be found and adjusted as `macro` in:

- `detect.hpp` (Thresholds, frame interval, etc.)
- `track.hpp` (Tracker states, maximum runing tracker, etc.)
- `funcs.hpp` (MOT input, frame rate, IoU threshhold)


Except KCF parameters:

- `kcftracker.cpp` (features used, cell size, padding size, etc.)


## Documentation

This project includes an auto-generated documentation using Doxygen.

See file `doc\index.html`.


## Third-party Code Attribution

This project includes modified portions of the KCF tracking algorithm from the open-source project:

- **KCFcpp**
- URL: [https://github.com/joaofaro/KCFcpp](https://github.com/joaofaro/KCFcpp)
- License: BSD 3-Clause License
- Copyright (c) 2015, Joao Faro

Modifications were made for feature calculation and APCE-based tracker reliability assessment.


## License

This project is licensed under the **Apache 2.0 License**.
See [LICENSE](./LICENSE) for details.

Third-party code from KCFcpp is licensed under the **BSD 3-Clause License**, see [LICENSE.thirdparty](./kcf/LICENSE.thirdparty) for full text.


## Author

**wantSomeChips**

University of Helsinki

[GitHub Profile](https://github.com/wantsomechips)




